<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>JANA2: JThread</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">JANA2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_src_lib__j_a_n_a__notes.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="class_j_thread.html">JThread</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The heart of the framework is in the <a class="el" href="class_j_thread.html">JThread</a> objects and the heart of them is in the Loop method. Here is a basic description of what goes on in Loop:</p>
<p>The loop is controlled by a member variable "mRunStateTarget". This can be set externally, primarily to tell the loop to pause or quit at the next iteration without interferening with what it is currently doing. Valid values are defined in the RUN_STATE_t enum defined inside the <a class="el" href="class_j_thread.html">JThread</a> class.</p>
<p>The basic workflow in one loop's iteration is:</p>
<ol type="1">
<li>Check if events need to be read from the source</li>
<li>Get the next task from the current event source's <a class="el" href="class_j_queue_set.html">JQueueSet</a> and run it if there is one</li>
<li>If there is no task then call the HandleNullTask method. This will: a. Check if all tasks and sub-tasks from the current source are done and if so, inform the <a class="el" href="class_j_thread_manager.html">JThreadManager</a> that the current source is exhausted and we need a new one b. If the current source is not completed, but there are currently no tasks available from it for the thread to work on, try switching to another open source and getting tasks from it. (This only happens if multiple sources are open simultaneously.)</li>
</ol>
<p>For item 1. the Loop may actually jump back to the beginning as it reads in events without processing them in an effort to make reading from the source more efficient. The idea is a quick succession of read requests will keep the disk spinning and the head from thrashing so you gain overall by buffering several events at once. How many are buffered is controlled by the the <a class="el" href="class_j_event_source.html">JEventSource</a> (see SetNumEventsToGetAtOnce method.) This feature may not matter for SSD's or reads.</p>
<p>A <a class="el" href="class_j_thread.html">JThread</a> object accesses a <a class="el" href="class_j_event_source.html">JEventSource</a> via the <a class="el" href="struct_j_thread_manager_1_1_j_event_source_info.html">JThreadManager::JEventSourceInfo</a> class. This class is used to group a <a class="el" href="class_j_event_source.html">JEventSource</a> pointer and a <a class="el" href="class_j_queue_set.html">JQueueSet</a> pointer together as a single entity. Note that the <a class="el" href="class_j_event_source.html">JEventSource</a> will provide a single <a class="el" href="class_j_queue.html">JQueue</a> for its events. The <a class="el" href="class_j_queue_set.html">JQueueSet</a> is created by the <a class="el" href="class_j_thread_manager.html">JThreadManager</a> and adds the source's queue as well as any queue's from the base set of queue's in the mTemplateQueueSet member of the <a class="el" href="class_j_thread_manager.html">JThreadManager</a>. The <a class="el" href="class_j_queue.html">JQueue</a> objects in the set are clones of the ones found in mTemplateQueueSet so they form a set unique to the <a class="el" href="class_j_event_source.html">JEventSource</a>.</p>
<h2><a class="el" href="class_j_thread_manager.html">JThreadManager</a> </h2>
<p>A single <a class="el" href="class_j_thread_manager.html">JThreadManager</a> object exists for the process. It is created in the <a class="el" href="class_j_application.html" title="JANA application class (singleton). ">JApplication</a> constructor and is owned by the <a class="el" href="class_j_application.html" title="JANA application class (singleton). ">JApplication</a> object. It is responsible for creating and managing threads as well as their associated <a class="el" href="class_j_queue_set.html">JQueueSet</a> objects. It also manages which <a class="el" href="class_j_event_source.html">JEventSource</a> object a <a class="el" href="class_j_thread.html">JThread</a> object uses at any given time.</p>
<h2><a class="el" href="class_j_queue_set.html">JQueueSet</a> </h2>
<p>Each <a class="el" href="class_j_event_source.html">JEventSource</a> will have it's own <a class="el" href="class_j_queue_set.html">JQueueSet</a> object created for it. The <a class="el" href="class_j_queue_set.html">JQueueSet</a> object is created and owned by the <a class="el" href="class_j_thread_manager.html">JThreadManager</a>. This is because it must combine the <a class="el" href="class_j_queue.html">JQueue</a> object from the <a class="el" href="class_j_event_source.html">JEventSource</a> itself with any other <a class="el" href="class_j_queue.html">JQueue</a> objects coming from reconstruction code. Keeping a separate <a class="el" href="class_j_queue_set.html">JQueueSet</a> for each source allows events from that source to be processed independently from other sources. Specifically, barrier events only need to serialize the processing of data from the source they came from. Since JANA supports reading from multiple <a class="el" href="class_j_event_source.html">JEventSource</a> objects simultaneously, unique <a class="el" href="class_j_queue_set.html">JQueueSet</a> objects are needed.</p>
<p>The <a class="el" href="class_j_queue_set.html">JQueueSet</a> is queried for a task from the <a class="el" href="class_j_thread.html#a2c21ceafdb6b5dd147191ed9d63d70e0">JThread::Loop</a>. The <a class="el" href="class_j_queue_set.html">JQueueSet</a> will loop through it's queue's by type first and then <a class="el" href="class_j_queue.html">JQueue</a> objects of that type to ensure a priority for the order in which tasks are processed. The <a class="el" href="class_j_queue_set.html">JQueueSet</a> keeps the <a class="el" href="class_j_queue.html">JQueue</a> objects in a std::map with keys being the queue type (defined in an enum that is part of the <a class="el" href="class_j_queue_set.html">JQueueSet</a> class). The values of the map are std::vector containers holding the actual queues. Due to the std::map ordering, the priority is given to the queue type in the order they are defined in the enum. Specifically: Output, SubTasks, Events. Thus, if an Event task is performed that creates subtasks, then those will be performed next before another task is pulled from an Event queue.</p>
<p><a class="el" href="class_j_queue_set.html">JQueueSet</a> objects are made by combining the <a class="el" href="class_j_queue.html">JQueue</a> object from a <a class="el" href="class_j_event_source.html">JEventSource</a> and clones of any <a class="el" href="class_j_queue.html">JQueue</a> objects in the JThreadManager::mTemplateQueueSet object. Plugins and libraries will need to add their <a class="el" href="class_j_queue.html">JQueue</a> objects to the template queue set by calling the AddQueue method of <a class="el" href="class_j_thread_manager.html">JThreadManager</a> before event processing starts. Note that the <a class="el" href="class_j_queue.html">JQueue</a> object passed into AddQueue will never actually be used to hold any tasks. It will just be used to clone itself to make new <a class="el" href="class_j_queue.html">JQueue</a> objects to go into <a class="el" href="class_j_queue_set.html">JQueueSet</a> objects as needed.</p>
<h2><a class="el" href="class_j_event_source.html">JEventSource</a> </h2>
<p><a class="el" href="class_j_event_source.html">JEventSource</a> is a base class for classes that read events into the program. User's will need to provide a class that inherits from this in order to provide input events to the JANA program.</p>
<h2>GetEvent:</h2>
<p>This method will be called to read in one "event" from the source. The event may simply be a large buffer containing one or more physics events. This is called serially so generally very little data processing should be done during this call. See the GetProcessEventTask method for details on how to setup the parsing as a separate that can be done in parallel while other events are being parsed or processed.</p>
<h2>GetObjects:</h2>
<p>This method will be called when a factory or processor requests some objects for the event. The <a class="el" href="class_j_event.html">JEvent</a> passed into this will be of the form that has the objects available. i.e. For more complicated sources that implement multiple queues to hold different forms of the event as it is parsed, this will typically be the final form of the event.</p>
<h2>GetProcessEventTask:</h2>
<p>This method is called to make a <a class="el" href="class_j_task.html">JTask</a> object for a given <a class="el" href="class_j_event.html">JEvent</a>. The <a class="el" href="class_j_event.html">JEvent</a> will have been obtained by an earlier call to GetEvent(). This is where one would implement code to process the <a class="el" href="class_j_event.html">JEvent</a>. For example, the GetEvent method might only read in an event buffer and wrap it as a <a class="el" href="class_j_event.html">JEvent</a> object. Any parsing of the buffer is deferred so it can be done in parallel as opposed to parsing it in the GetEvent method which is called serially. The parsing code would naturally fit into the process event task.</p>
<p>There is a default GetProcessEventTask method defined in <a class="el" href="class_j_event_source.html">JEventSource</a> that will make a <a class="el" href="class_j_task.html">JTask</a> that simply calls all of the JEventProcessors for the <a class="el" href="class_j_event.html">JEvent</a>. (This uses the JMakeAnalyzeEventTask routine defined in JFunctions.cc.) If the user provides their own GetProcessEventTask method, they should eventually generate a task that runs the processors. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 28 2019 13:28:33 for JANA2 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
